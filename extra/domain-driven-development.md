# 도메인 모델의 시작

## 도메인이란?
도메인은 `소프트웨어로 해결하고자 하는 영역`을 말한다.
한 도메인은 다시 하위 도메인으로 나눌 수 있다.
ex)
도메인 : 온라인 서점
하위 도메인 : 회원, 주문, 결제, 배송 등등...

도메인 일부 기능은 자체 시스템으로 구현하고, 일부 기능은 외부 업체의 시스템을 사용할 수도 있다.
ex) 결제기능은 이니시스의 결제 시스템을 사용한다던지...

## 도메인 모델이란?
특정 도메인을 개념적으로 표현한 것이다.
도메인이 제공하는 기능과 주요 데이터 구성을 표현한다.
도메인을 모델링할 때 기본이 되는 작업은 모델을 구성하는 핵심 구성요소, 규칙, 기능을 찾는 것이다.

## 엔티티와 벨류
엔티티의 가장 큰 특징은 식별자를 갖는다는 것이다.
식별자는 엔티티 객체마다 고유해서 각 엔티티는 서로 다른 식별자를 갖는다.
그러므로 식별자가 같으면 동일한 엔티티라고 판단한다.
엔티티는 식별자를 이용해서 equals(), hashCode()를 구현할 수 있다.
ex) 주문 도메인 -> 주문번호

일정한 규칙을 가지고 만들거나 DB에서 제공하는 자동 증가 기능을 통해 식별자를 생성할 수도 있다.
Java에서 UUID(Universally Unique Identifier)를 사용해서 식별자를 생성하는 경우는 다음과 같다.
~~~
UUID uuid = UUID.randomUUID();

// 615f2ab9-c374-4b50-9420-2154594af151과 같은 문자열
String strUuid = uuid.toString()
~~~

벨류 타입은 개념적으로 명확하게 표현할 수 있게 해준다.

# 애그리거트와 트랜젝션 관리
트랜젝션의 종류에는 선점(Pessimistic) 잠금과 비선점(Optimistic) 잠금 두 가지 방식이 있다.

## 선점 잠금
선점 잠금은 먼저 애그리거트를 구한 스레드가 애그리거트 사용이 끝날 때 까지 다른 스레드가 해당 애그리거트를 수정하는 것을 막는 것이다.
선점 잠금 방식으로 애그리거트를 구하면 스레드 1이 잠금을 해제할 때까지 블로킹 된다.
ex) 스레드 1이 애그리거트를 수정하고 트랜잭션을 커밋하면 잠금이 해제된다.
이 순간 대기하고 있던 스레드2가 애그리거트에 접근하게 된다.

=> 한 스레드가 애그리거트를 구하고 수정하는 동안 다른 스레드가 수정할 수 없으므로 동시에 애그리거트를 수정할 때 발생하는 데이터 충돌 문제를 해소할 수 있다.

선점 잠금은 보통 DBMS가 제공하는 행 단위 잠금을 사용해서 구현한다.
ex) 오라클을 비롯한 다수 DBMS가 for update와 같은 쿼리 사용해서 구현할 수 있음.
